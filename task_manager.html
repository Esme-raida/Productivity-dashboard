<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Task Manager</title>
  <link rel="stylesheet" href="./output.css" />
</head>
<body class="min-h-screen max-w-screen px-2 py-2 bg-gray-100">
        <!-- HEADER -->
   <header class="dashboard-header">
   <h1 class="text-3xl font-bold font-sans">ðŸ§ Task Manager</h1>
    </header>
   <main class="task-dashboard">
   <div class="flex flex-row justify-between pt-5 text-gray-800">
        <span id="backBtn"  class="text-gray-600 hover:cursor-pointer hover:scale-110 hover:text-black" aria-label="Back" title="Back">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
            </svg>
        </span>
                <!-- FLOATING ACTION BUTTON -->
        <div id="modalContainer" class="relative mr-2.5">
          <button id="fabButton" class="hover:cursor-pointer" aria-label="Menu Button" title="Menu Button">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>
          </button>
                    <!--TASK MODAL -->
            <div id="taskAction" class="hidden absolute right-5 w-35 border rounded border-gray-600 shadow-2xl p-3 bg-gray-200">
            <div class="flex flex-row" id="modalContent">
                <span id="addButton" class="hover:scale-110 hover:cursor-pointer hover:bg-white p-2 rounded-md flex items-center w-10 h-10" aria-label="Add New Task" title="Add New Task">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                </span>
                <span id="deleteButton" class="hover:scale-110  hover:cursor-pointer hover:bg-white p-2 rounded-md flex items-center w-10 h-10" aria-label="Delete task" title="Delete task">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                    </svg>
                </span>
                <span id="editButton" class="hover:scale-110 hover:cursor-pointer hover:bg-white p-2 rounded-md flex items-center w-10 h-10" aria-label="Edit task" title="Edit task">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                    </svg>
                </span>
            </div>
            </div>
        </div>
   </div>  
    <h3 class="text-center font-semibold text-2xl -mt-2 font-serif">ALL TASKS</h3>

    <!-- TODAY'S TASKS -->
    <section id="today-tasks" class=" bg-gray-50 rounded-lg mb-3 mt-3 shadow-lg p-4 hover:cursor-pointer">
      <h2 class="text-2xl font-medium">Today</h2>
      <ul class="" id="today-list">
      </ul>
    </section>

    <section id="tomorrow-tasks" class="bg-gray-50 mb-3 rounded-lg shadow-lg p-4 hover:cursor-pointer">
      <h2 class="text-2xl font-medium">Tomorrow</h2>
      <ul class="" id="tomorrow-list">
      </ul>
    </section>

    <!-- UPCOMING TASKS -->
    <section id="upcoming-tasks" class="bg-gray-50 mb-3 rounded-lg shadow-lg p-4 hover:cursor-pointer">
      <h2 class="text-2xl font-medium">Upcoming</h2>
      <ul class="" id="upcoming-list">
        <!-- Tasks added dynamically -->
      </ul>
    </section>

    <!-- COMPLETED TASKS -->
    <section id="completed-tasks" class="bg-gray-100 mb-2 rounded-lg shadow-lg p-4 hover:cursor-pointer">
      <h2 class="text-2xl font-medium">Completed</h2>
      <ul class="task-list" id="completed-list">
        <!-- Completed tasks added dynamically -->
      </ul>
    </section>
  </main>
    <!--ADD TASKS-->
      <div id="bottomSheet" class="flex items-center justify-center backdrop:blur-sm hidden">
      <form id="taskForm" class="bottom-0 left-0 right-0 flex flex-row  bg-gray-200  gap-2 p-6 rounded-t-lg shadow-lg transition-transform translate-y-full duration-300 rounded-sm">
      <input type="text" id="task-title" class="hover:cursor-pointer outline-gray-600 border-gray-600 border rounded-sm p-1" placeholder="Task title" required />
      <input type="date" id="task-date" class="hover:cursor-pointer  outline-gray-600 border-gray-600 border rounded-sm p-1 " required />
      <label class="hover:cursor-pointer outline-gray-700 border-gray-600 border rounded-sm p-1 ">
          <input name="checkbox" type="checkbox" class="hover:cursor-pointer accent-gray-500" id="task-priority" />
          High Priority
      </label>
      <div id="modalActions" class="flex flex-row gap-2">
          <button type="submit" class="hover:bg-gray-400 hover:cursor-pointer bg-gray-800 text-white px-2 rounded-sm">Add Task</button>
          <button type="button" id="cancelButton" class="hover:bg-gray-400 hover:cursor-pointer bg-gray-800 text-white px-2 rounded-sm">Cancel</button>
      </div>
      </form>
      </div>
  <script>
    //----------------------------------------------------------DOM ELEMENT-------------------------------------------------------//
    window.addEventListener("DOMContentLoaded", () => {
      const backBtn = document.getElementById('backBtn');
      const floatingActionButton = document.getElementById('fabButton');
      const taskAction = document.getElementById('taskAction');
      const addButton = document.getElementById('addButton');
      const bottomSheet = document.getElementById('bottomSheet');
      const taskForm = document.getElementById('taskForm');
      const taskTitle = taskForm['task-title'];
      const taskDate = taskForm['task-date'];
      const cancelButton = document.getElementById('cancelButton');
      const deleteButton = document.getElementById('deleteButton');
      const editButton = document.getElementById('editButton');
      const todayList = document.getElementById('today-list');
      const tomorrowList = document.getElementById('tomorrow-list');
      const upcomingList = document.getElementById('upcoming-list');
      const completedList = document.getElementById('completed-list');

      let todayTasks = [];
      let tomorrowTasks = [];
      let upcomingTasks = [];
      let completedTasks = [];
      let selectedTaskElement = null;
      let selectedTaskData = null;
      let draggedElement = null;

      //----------------------------------------------------------BACK BUTTON FUNCTONALITY----------------------------------//
      backBtn.addEventListener('click', () => {
        window.location.href = 'dashboard.html';
      });

      //-----------------------------------------FLOATING ACTION BUTTON FUNCTIONALITY------------------------------------------------//
      // When FAB button is clicked - toggle dropdown and prevent event bubbling
      floatingActionButton.addEventListener('click', (event) => {
        // Stop event from bubbling up to document to prevent immediate closing
        event.stopPropagation();  // Prevent immediate closing
        // Toggle the dropdown visibility
        taskAction.classList.toggle('hidden');
        floatingActionButton.classList.toggle('scale-110');
        //Toggle svg color
        const svg = floatingActionButton.querySelector('svg');
        if (svg) svg.classList.toggle('text-gray-500'); // Toggle color
      });
      
      // Close dropdown when clicking outside of it
      document.addEventListener('click', (event) => {
        const clickedOnFab = floatingActionButton.contains(event.target);
        const clickedInDropdown = taskAction.contains(event.target);

        if (!clickedOnFab && !clickedInDropdown) {
          taskAction.classList.add('hidden');
          floatingActionButton.classList.remove('scale-110');
          const svg = floatingActionButton.querySelector('svg');
          if (svg) svg.classList.remove('text-gray-500');
        }
      });

      //-----------------------------------------------WHEN ADD BUTTON IS CLICKED-------------------------------------------------------//
      addButton.addEventListener('click', () => {
        taskAction.classList.add('hidden');
        bottomSheet.classList.toggle('hidden'); //Show the adding block/taskform
        taskForm.reset();
      });
      
       //-----------------------------------------------WHEN CANCEL BUTTON IS CLICKED-------------------------------------------------------//
      cancelButton.addEventListener('click', () => {
        bottomSheet.classList.add('hidden');
        taskForm.reset();
        selectedTaskElement = null;
        selectedTaskData = null;
      });

      //-------------------------------------FUNCTION TO UPDATE TASK IN LOCAL STORAGE----------------------------------------------------//
      function updateTasksInLocalStorage() {
        localStorage.setItem("todayTasks", JSON.stringify(todayTasks));
        localStorage.setItem("tomorrowTasks", JSON.stringify(tomorrowTasks));
        localStorage.setItem("upcomingTasks", JSON.stringify(upcomingTasks));
        localStorage.setItem("completedTasks", JSON.stringify(completedTasks));
      }
      
      // -------------------------------------------- CREATE TASK ELEMENT FUNCTION -----------------------------------------------//
      function createTaskElement(task, targetList) {
        const taskElement = document.createElement('li');
        const wrapper = document.createElement('div'); // wraps the checkbox + text
        wrapper.classList.add('flex', 'items-center', 'gap-2');
        const priorityLabel = document.createElement('span');
        
        // Real Hidden Checkbox
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.classList.add('hidden');
        checkbox.checked = task.done || false; // Keep state from localStorage
        
        // Creating SVG Checkbox UI here
        const customCheckbox = document.createElement('span');
        customCheckbox.classList.add('cursor-pointer');
        customCheckbox.innerHTML = checkbox.checked
          ? `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="#D1D5DB" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="12" fill="#D1D5DB"/>
              <path d="M16.5 9L10.5 15L7.5 12" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>`
          : `<div class="w-6 h-6 rounded-full border-2 border-gray-400"></div>`;
        
        // Task Text
        const taskText = document.createElement('span');
        taskText.textContent = task.title;
        taskText.setAttribute('title', task.title);
        taskText.classList.add('task-title', 'ml-1');
        
         //If the task is of high priority
        if (task.priority) {
          priorityLabel.textContent = "High Priority";
          priorityLabel.classList.add('bg-red-500', 'text-white', 'text-xs', 'px-2', 'py-1', 'rounded-full', 'ml-10', 'flex-end');
        }
        
         //Apply visual styling immediately page loads if task is already done then
        if (task.done) {
          taskText.classList.add('line-through', 'text-gray-400', 'italic');
        }
        
         //functionality for when task is overdue
        if (task.overdue && !task.done) {
          taskText.classList.add('text-red-500', 'italic');
          const overdueBadge = document.createElement('span');
          overdueBadge.textContent = "Overdue";
          overdueBadge.classList.add('ml-2', 'text-xs', 'bg-red-200', 'text-red-700', 'px-2', 'py-0.5', 'rounded-full');
          wrapper.appendChild(overdueBadge);
        }
        
        // Toggle Logic: Click on checkbox icon
        customCheckbox.addEventListener('click', (event) => {
          event.stopPropagation();
          checkbox.checked = !checkbox.checked; //flips the checked status
          task.done = checkbox.checked; //updates the task.done with that boolean

          // Update icon/checkbox
          customCheckbox.innerHTML = checkbox.checked //is it checked, if it is
            ? `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="#D1D5DB" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="12" fill="#D1D5DB"/>
                <path d="M16.5 9L10.5 15L7.5 12" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>`
            : `<div class="w-6 h-6 rounded-full border-2 border-gray-400"></div>`;
          
          // Remove it from wherever it is first
          taskElement.remove();

          if (task.done) { //if true
             //Add strikethrough //Make the text-gray 
            taskText.classList.add('line-through', 'text-gray-400', 'italic');
            completedList.appendChild(taskElement);
            completedTasks.push(task);

                      //Remove that task from any of the tasks array it is in
          //.filter goes through all the items in the array and keeps only the item that returns true for the condition stated,
          //but we flipped it, so it will keep only the item that does not match
            todayTasks = todayTasks.filter(t => !(t.title === task.title && t.date === task.date));
            tomorrowTasks = tomorrowTasks.filter(t => !(t.title === task.title && t.date === task.date));
            upcomingTasks = upcomingTasks.filter(t => !(t.title === task.title && t.date === task.date));
            //I used .filter because it returns array
          } else {
            //Remove strikethrough  //Remove the gray-text 
            taskText.classList.remove('line-through', 'text-gray-400', 'italic');
            //Remove from completed Task
            completedTasks = completedTasks.filter(t => !(t.title === task.title && t.date === task.date));
           
            //Reset all times (hour/min/sec) to midnight (00:00).
            const taskDateObj = new Date(task.date);
            const taskDateOnly = new Date(taskDateObj.getFullYear(), taskDateObj.getMonth(), taskDateObj.getDate());
            const now = new Date();
            const todayOnly = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const tomorrowOnly = new Date(todayOnly);
            tomorrowOnly.setDate(todayOnly.getDate() + 1);

            if (taskDateOnly.getTime() < todayOnly.getTime()) {
              taskText.classList.add('text-red-500', 'italic');
              const overdueBadge = document.createElement('span');
              overdueBadge.textContent = "Overdue";
              overdueBadge.classList.add('ml-2', 'text-xs', 'bg-red-200', 'text-red-700', 'px-2', 'py-0.5', 'rounded-full');
              wrapper.appendChild(overdueBadge);
              todayList.appendChild(taskElement);
              todayTasks.push(task);
            } else if (taskDateOnly.getTime() === todayOnly.getTime()) {
              todayList.appendChild(taskElement);
              todayTasks.push(task);
            } else if (taskDateOnly.getTime() === tomorrowOnly.getTime()) {
              tomorrowList.appendChild(taskElement);
              tomorrowTasks.push(task);
            } else {
              upcomingList.appendChild(taskElement);
              upcomingTasks.push(task);
            }
          }

          updateTasksInLocalStorage();
        });
        //----------------FUNCTION TO UPDATE TASK SELECTION LOGIC--------------------//
        taskElement.addEventListener('click', (event) => {
          //Find all tasks with the class 'selected-task'
          if (event.target === customCheckbox || customCheckbox.contains(event.target)) return;
          document.querySelectorAll('li.selected-task').forEach(task => {
            //Loop through and remove selection style from all of them
            task.classList.remove('selected-task', 'bg-blue-100', 'border', 'rounded-md', 'border-blue-500');
          });
          //Add classes to this clicked task to mark it as selected
          taskElement.classList.add('selected-task', 'bg-blue-100', 'border', 'rounded-md', 'border-blue-500');
          //this is to store the selected task element globally
          selectedTaskElement = taskElement;
          // this is to store the actual task data (title, date, etc.)
          selectedTaskData = task;
        });
        
        // Combine all elements
        wrapper.appendChild(checkbox);
        wrapper.appendChild(customCheckbox);
        wrapper.appendChild(taskText);
        wrapper.appendChild(priorityLabel);
        taskElement.appendChild(wrapper);
        taskElement.classList.add('mt-2');

        //Add the task to the section in the UI
        targetList.appendChild(taskElement);
      }

      //--------------------------------------ADD TASK TO STORAGE AND DISPLAY--------------------------------------------------//

      taskForm.addEventListener('submit', (event) => {
        event.preventDefault();
        bottomSheet.classList.add('hidden');

        const taskTitleInput = taskTitle.value;
        const taskDateInput = taskDate.value;
        const isChecked = taskForm.elements.checkbox.checked; //returns true or false

        if (taskTitleInput && taskDateInput) {
          const taskDateObj = new Date(taskDateInput);
          const taskDateOnly = new Date(taskDateObj.getFullYear(), taskDateObj.getMonth(), taskDateObj.getDate());

          const today = new Date();
          const todayDate = new Date(today.getFullYear(), today.getMonth(), today.getDate());
          const tomorrowDate = new Date(todayDate);
          tomorrowDate.setDate(tomorrowDate.getDate() + 1); // adds 1 day
      
         //-----------------------------------------------TASK OBJECT CREATED--------------------------------------//
          //Task object to be added to local storage representing a single task
          const task = {
            title: taskTitleInput,
            date: taskDateInput,
            done: false, // Whether the task is completed
            priority: isChecked // reflects the checkbox state
          };

          if (taskDateOnly.getTime() === todayDate.getTime()) {
            createTaskElement(task, todayList); // display today lists
            todayTasks.push(task); // save to the todaytasks array
            localStorage.setItem("todayTasks", JSON.stringify(todayTasks));
          } else if (taskDateOnly.getTime() === tomorrowDate.getTime()) {
            createTaskElement(task, tomorrowList);
            tomorrowTasks.push(task);
            localStorage.setItem("tomorrowTasks", JSON.stringify(tomorrowTasks));
          } else if (taskDateOnly.getTime() > tomorrowDate.getTime()) {
            createTaskElement(task, upcomingList);
            upcomingTasks.push(task);
            localStorage.setItem("upcomingTasks", JSON.stringify(upcomingTasks));
          }

          // Clear input fields after adding
          taskTitle.value = '';
          taskDate.value = '';
          taskForm.elements.checkbox.checked = false;
        }
      });
    
          //-------------------------------------------------------DELETE BUTTON-----------------------------------------//
      deleteButton.addEventListener('click', () => {
        if (!selectedTaskElement || !selectedTaskData) {
          alert("Please select a task to delete.");
          return;
        }
        //Remove from wherever it is 
        selectedTaskElement.remove();

        //Remove from the correct array
        const title = selectedTaskData.title;
        const date = selectedTaskData.date;

        // Filter it out of every array it might be in
        todayTasks = todayTasks.filter(task => !(task.title === title && task.date === date));
        tomorrowTasks = tomorrowTasks.filter(task => !(task.title === title && task.date === date));
        upcomingTasks = upcomingTasks.filter(task => !(task.title === title && task.date === date));
        completedTasks = completedTasks.filter(task => !(task.title === title && task.date === date));

        //Update Storage
        updateTasksInLocalStorage();

        //clear selected task
        selectedTaskElement = null;
        selectedTaskData = null;
      });
      //-----------------------------------------------------EDIT TASKS BUTTON-------------------------------------------------------//
      editButton.addEventListener('click', () => {
        if (!selectedTaskData || !selectedTaskElement) {
          alert("Please select a task to edit.");
          return;
        }
        //Show the form if task selected.
        bottomSheet.classList.remove('hidden');
        // Fill form with task data all over again
        taskTitle.value = selectedTaskData.title;
        taskDate.value = selectedTaskData.date;
        taskForm.elements.checkbox.checked = selectedTaskData.priority;

        // Remove the original task visually and from array for now
        selectedTaskElement.remove();
        todayTasks = todayTasks.filter(task => !(task.title === selectedTaskData.title && task.date === selectedTaskData.date));
        tomorrowTasks = tomorrowTasks.filter(task => !(task.title === selectedTaskData.title && task.date === selectedTaskData.date));
        upcomingTasks = upcomingTasks.filter(task => !(task.title === selectedTaskData.title && task.date === selectedTaskData.date));
        completedTasks = completedTasks.filter(task => !(task.title === selectedTaskData.title && task.date === selectedTaskData.date));

        updateTasksInLocalStorage();

        // Clear selected state
        selectedTaskElement = null;
        selectedTaskData = null;
      });

    //-----------------------------function to load from localStorage---------------------------------//

      function loadTasksFromStorage() {
        try {
          let allTasks = [
            ...(JSON.parse(localStorage.getItem("todayTasks")) || []),
            ...(JSON.parse(localStorage.getItem("tomorrowTasks")) || []),
            ...(JSON.parse(localStorage.getItem("upcomingTasks")) || []),
            ...(JSON.parse(localStorage.getItem("completedTasks")) || [])
          ];

          todayTasks = [];
          tomorrowTasks = [];
          upcomingTasks = [];
          completedTasks = [];

          const now = new Date();
          const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
          const tomorrow = new Date(today);
          tomorrow.setDate(tomorrow.getDate() + 1);

          const sortByPriority = (a, b) => {
            if (a.priority === true && b.priority !== true) return -1;
            if (a.priority !== true && b.priority === true) return 1;
            return 0;
          };

          allTasks.forEach(task => {
            const taskDate = new Date(task.date);
            const taskDay = new Date(taskDate.getFullYear(), taskDate.getMonth(), taskDate.getDate());

            if (task.done) {
              completedTasks.push(task);
              createTaskElement(task, completedList);
            } else if (taskDay.getTime() === today.getTime()) {
              todayTasks.push(task);
              createTaskElement(task, todayList);
            } else if (taskDay.getTime() === tomorrow.getTime()) {
              tomorrowTasks.push(task);
              createTaskElement(task, tomorrowList);
            } else if (taskDay.getTime() > tomorrow.getTime()) {
              upcomingTasks.push(task);
              createTaskElement(task, upcomingList);
            } else {
              todayTasks.push({ ...task, overdue: true });
              createTaskElement({ ...task, overdue: true }, todayList);
            }
          });

          todayTasks.sort(sortByPriority);
          tomorrowTasks.sort(sortByPriority);
          upcomingTasks.sort(sortByPriority);

          updateTasksInLocalStorage();
        } catch {
          todayTasks = [];
          tomorrowTasks = [];
          upcomingTasks = [];
          completedTasks = [];
        }
      }

      loadTasksFromStorage();
    });

  </script>
</body>
</html>
