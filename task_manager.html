<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tttask Manager</title>
  <link rel="stylesheet" href="./output.css" />
</head>
<body class="min-h-screen max-w-screen px-2 py-2">
        <!-- HEADER -->
   <header class="dashboard-header">
   <h1 class="text-3xl font-bold font-sans">ðŸ§ Task Manager</h1>
    </header>
   <main class="task-dashboard">
   <div class="flex flex-row justify-between pt-5 text-gray-800">
        <span id="backBtn"  class="text-gray-600 hover:cursor-pointer hover:scale-110 hover:text-black" aria-label="Back" title="Back">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
            </svg>
        </span>
                <!-- FLOATING ACTION BUTTON -->
        <div id="modalContainer" class="relative mr-2.5">
          <button id="fabButton" class="hover:cursor-pointer" aria-label="Menu Button" title="Menu Button">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>
          </button>
                    <!--TASK MODAL -->
            <div id="taskAction" class="hidden absolute right-5 w-35 border rounded border-gray-600 shadow-2xl p-3 bg-gray-200">
            <div class="flex flex-row" id="modalContent">
                <span id="addButton" class="hover:scale-110 hover:cursor-pointer hover:bg-white p-2 rounded-md flex items-center w-10 h-10" aria-label="Add New Task" title="Add New Task">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                </span>
                <span id="deleteButton" class="hover:scale-110  hover:cursor-pointer hover:bg-white p-2 rounded-md flex items-center w-10 h-10" aria-label="Delete task" title="Delete task">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                    </svg>
                </span>
                <span id="editButton" class="hover:scale-110 hover:cursor-pointer hover:bg-white p-2 rounded-md flex items-center w-10 h-10" aria-label="Edit task" title="Edit task">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                    </svg>
                </span>
            </div>
            </div>
        </div>
   </div>  
    <h3 class="text-center font-semibold text-2xl -mt-2 font-serif">ALL TASKS</h3>

    <!-- TODAY'S TASKS -->
    <section id="today-tasks" class=" bg-gray-50 rounded-lg mb-3 mt-3 shadow-lg p-4 hover:cursor-pointer">
      <h2 class="text-2xl font-medium">Today</h2>
      <ul id="todayList">
      </ul>
    </section>

    <section id="tomorrow-tasks" class="bg-gray-50 mb-3 rounded-lg shadow-lg p-4 hover:cursor-pointer">
      <h2 class="text-2xl font-medium">Tomorrow</h2>
      <ul id="tomorrowList">
      </ul>
    </section>

    <!-- UPCOMING TASKS -->
    <section id="upcoming-tasks" class="bg-gray-50 mb-3 rounded-lg shadow-lg p-4 hover:cursor-pointer">
      <h2 class="text-2xl font-medium">Upcoming</h2>
      <ul id="upcomingList">
        <!-- Tasks added dynamically -->
      </ul>
    </section>

    <!-- COMPLETED TASKS -->
    <section id="completed-tasks" class="bg-gray-100 mb-2 rounded-lg shadow-lg p-4 hover:cursor-pointer">
      <h2 class="text-2xl font-medium">Completed</h2>
      <ul id="completedList">
        <!-- Completed tasks added dynamically -->
      </ul>
    </section>
  </main>
    <!--ADD TASKS-->
      <div id="bottomSheet" class="flex items-center justify-center backdrop:blur-sm hidden">
      <form id="taskForm" class="bottom-0 left-0 right-0 flex flex-row  bg-gray-200  gap-2 p-6 rounded-t-lg shadow-lg transition-transform translate-y-full duration-300 rounded-sm">
      <input type="text" id="task-title" class="hover:cursor-pointer outline-gray-600 border-gray-600 border rounded-sm p-1" placeholder="Task title" required />
      <input type="date" id="task-date" class="hover:cursor-pointer  outline-gray-600 border-gray-600 border rounded-sm p-1 " required />
      <label class="hover:cursor-pointer outline-gray-700 border-gray-600 border rounded-sm p-1 ">
          <input name="checkbox" type="checkbox" class="hover:cursor-pointer accent-gray-500" id="task-priority" />
          High Priority
      </label>
      <div id="modalActions" class="flex flex-row gap-2">
          <button type="submit" class="hover:bg-gray-400 hover:cursor-pointer bg-gray-800 text-white px-2 rounded-sm">Add Task</button>
          <button type="button" id="cancelButton" class="hover:bg-gray-400 hover:cursor-pointer bg-gray-800 text-white px-2 rounded-sm">Cancel</button>
      </div>
      </form>
      </div>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const backBtn = document.getElementById('backBtn');
      const fabButton = document.getElementById('fabButton');
      const taskAction = document.getElementById('taskAction');
      const addButton = document.getElementById('addButton');
      const deleteButton = document.getElementById('deleteButton');
      const editButton = document.getElementById('editButton');
      const bottomSheet = document.getElementById('bottomSheet');
      const taskForm = document.getElementById('taskForm');
      const taskTitle = taskForm['task-title'];
      const taskDate = taskForm['task-date'];
      const priority = taskForm['task-priority'];
      const cancelButton = document.getElementById('cancelButton');
      const todayList = document.getElementById('todayList');
      const tomorrowList = document.getElementById('tomorrowList');
      const upcomingList = document.getElementById('upcomingList'); 
      const completedList = document.getElementById ('completedList');
      let allTasks = [];
      let selectedTask = null;
      let selectedTaskData = null;
     

      //-----------------------------------------------FUNCTION TO UPDATE LOCAL STORAGE--------------------------------------------------//
      function updateTasksInLocalStorage() {
        localStorage.setItem("allTasks", JSON.stringify(allTasks));
      }
      
      //------------------------------------------------GETTING ITEMS BACK ON PAGE LOAD-------------------------------------------------//
      function loadTasksFromStorage() {
        try {
          todayList.innerHTML = '';
          tomorrowList.innerHTML = '';
          upcomingList.innerHTML = '';
          completedList.innerHTML = '';

          allTasks = JSON.parse(localStorage.getItem("allTasks")) || [];
          //I'll start with sorting by priority since I can't do that after retriving from localStorage
          const sortByPriority = (a, b) => {
            //Negative number means put the first before the secon
            //Positive means the second before the first
            //0 means leave them as they are 
            //If a is high-priority And b is NOT high-priority then a should come first
            if (a.priority === true && b.priority !== true) return -1
            if (a.priority !== true && b.priority == true) return 1;
            return 0
          } 
          //CREATING AND COMPARING DATES NOW
          const todayDate = new Date();
          const todayDateOnly = new Date(todayDate.getFullYear(), todayDate.getMonth(), todayDate.getDate());
         
          const tomorrowDateOnly = new Date (todayDateOnly) // a copy of today date
          tomorrowDateOnly.setDate(tomorrowDateOnly.getDate() + 1);
         
          //Overdue
          const now = new Date()
          const yesterdayDate = new Date(now);
          yesterdayDate.setDate(yesterdayDate.getDate() - 1);
          
          allTasks.sort(sortByPriority)
          
          allTasks.forEach(task => {
             const taskDateFull = new Date(task.date);
             const taskDateOnly = new Date(taskDateFull.getFullYear(), taskDateFull.getMonth(), taskDateFull.getDate());

         
            if (task.done) {
              createTaskElement(task, completedList)
              } else if(taskDateOnly.getTime() === todayDateOnly.getTime()) {
                createTaskElement(task, todayList);
              } else if (taskDateOnly.getTime() === tomorrowDateOnly.getTime()) {
                createTaskElement(task, tomorrowList);
              } else if (taskDateOnly.getTime() > tomorrowDateOnly.getTime()) {
                createTaskElement(task, upcomingList);
              } else if (taskDateOnly.getTime() < todayDateOnly.getTime()) {
                task.overdue = true;
                createTaskElement(task, todayList);
              }
        });

        } catch{
          allTasks = [];
        }
      }
      //-----------------------------------------------BACK BUTTON FUNCTIONALITY------------------------------------------------------//
      backBtn.addEventListener('click', () => {
          window.location.href = 'dashboard.html';
      });
      
      //---------------------------------------------------FAB BUTTON FUNCTIONALITY----------------------------------------------//
      fabButton.addEventListener('click', () => {
          const svg = fabButton.querySelector('svg'); // to get the svg of this fab button
          svg.classList.toggle('scale-110', 'text-gray-400'); //adding visual styling to that svg when clicked
          taskAction.classList.toggle('hidden'); 
      });
      
      //functionality to check if anywhere outside the taskAction or the task button was clicked
      document.addEventListener('click', (event) => {
          const clickedOnFab = fabButton.contains(event.target);
          const clickedInDropdown = taskAction.contains(event.target); 
          
          if (clickedOnFab !== true && clickedInDropdown !== true) {
              taskAction.classList.add('hidden');
          }
      });
      
      //------------------------------------------------ADD BUTTON FUNCTIONALITY----------------------------------------------------------//
      addButton.addEventListener('click', () => {
          bottomSheet.classList.remove('hidden');
      });

      //------------------------------------------------------TASK FORM FUNCTIONALITY------------------------------------------------------//
      taskForm.addEventListener('submit', (event) => {
          event.preventDefault();
          //CREATING THE TASK OBJECT
          const task = {
              title : taskTitle.value,
              date : taskDate.value,
              priority : priority.checked || false,
              done: false 
          }
          allTasks.push(task);
          updateTasksInLocalStorage();
          loadTasksFromStorage();

         
          taskForm.reset()
          bottomSheet.classList.add('hidden');
      });
      //---------------------------------------------------------CREATE ELEMENT FUNCTIONALITY---------------------------------//
      function createTaskElement(task, targetList) {

        //----------------------------------------------CREATION OF THE ELEMENTS---------------------------------//
        
        //CREATING A LIST FOR EACH TASK ADDED
        const taskElement = document.createElement('li');
        //A wrapper to house all the oitems and be appended as one to the list
        const wrapper = document.createElement('div');
        //The priority Label creation
        const priorityLabel = document.createElement('span');
        //styling the wrapper
        wrapper.classList.add('flex', 'gap-2', 'mt-2', 'mb-2', 'items-center');

        //The text div
        const taskText = document.createElement('span');
        taskText.classList.add('task-title','text-black','ml-1');
        taskText.textContent = task.title;
        //creating a checkbox for usage, but hiding it to use an svg, but i'll be making use of that same functionality
        const checkbox = document.createElement('input');
        checkbox.type = "checkbox";
        checkbox.classList.add('hidden');
        checkbox.checked = task.done || false;

        //The custom svg checkbox, check if it was checked on page load, if yes create the latter else create the first 
        const customCheckbox = document.createElement('span');
        customCheckbox.classList.add('cursor-pointer');
        customCheckbox.innerHTML = checkbox.checked
            ? `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="#D1D5DB" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="12" fill="#D1D5DB"/>
                <path d="M16.5 9L10.5 15L7.5 12" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>`
            : `<div class="w-6 h-6 rounded-full border-2 border-gray-400"></div>`;
        
        //Priority text
        if (task.priority) {
          priorityLabel.textContent = "High Priority";
          priorityLabel.classList.add('bg-red-500', 'text-white', 'text-xs', 'px-2', 'py-1', 'rounded-full', 'ml-1', 'flex-end');
        }

        //On page load
        if (task.done) {
          taskText.classList.add('line-through', 'text-gray-400', 'italic');
        }
        
        if (!task.done && task.overdue) {
          const overdueBadge = document.createElement('span');
          overdueBadge.textContent = "Overdue";
          overdueBadge.classList.add('rounded-full', 'bg-red-200', 'text-red-700', 'text-xs', 'px-2', 'py-0.5');
          wrapper.append(overdueBadge);
        }  
      //-------------------------------------------PROPERLY APPENDING CREATED ELEMENTS NOW-----------------------------------------//
        customCheckbox.addEventListener('click', () => {
          checkbox.checked = !checkbox.checked;
          task.done = checkbox.checked;

          customCheckbox.innerHTML = checkbox.checked //is it checked, if it is
              ? `<svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="#D1D5DB" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="12" fill="#D1D5DB"/>
                  <path d="M16.5 9L10.5 15L7.5 12" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>`
              : `<div class="w-6 h-6 rounded-full border-2 border-gray-400"></div>`;
            
          taskElement.remove(); //removes it automatically from whtever list it is in
          const index = allTasks.findIndex(t => t.title === task.title && t.date === task.date);
          if (index !== -1) {
           allTasks[index].done = checkbox.checked;
          }

          //-------------------IF TASK IS DONE, WHICH WE JUST FLIPPED ABOVE, BUT WE CHECK TO BE SURE------------//
          if(task.done) {
            taskText.classList.add('text-gray-500', 'line-through', 'italic');
          } else {
            taskText.classList.remove('text-gray-500', 'line-through', 'italic');
          }    
          updateTasksInLocalStorage();
          loadTasksFromStorage();
        });

        //--------------------------------------------------------------SELECTION LOGIC----------------------------------------//
        taskElement.addEventListener('click', (event) => {
          //prevents the code from running if the user clicked the checkbox
          if (event.target.closest('.cursor-pointer')) return;
          //if element is selected...
          selectedTask = taskElement;
          selectedTaskData = task;
          localStorage.setItem("selectedTaskData", JSON.stringify(selectedTaskData));
          //Remove tsyling from any previously selected element
          document.querySelectorAll('li.selected-task').forEach(task => {
            task.classList.remove('selected-task', 'bg-blue-100', 'border', 'rounded-md', 'border-blue-500' )
          })
          taskElement.classList.add('selected-task', 'bg-blue-100', 'border', 'rounded-md', 'border-blue-500')
        });
        //-------------------------ADDING EVERYTHING NOW TO THE LIST FOR EACH TASK ELEMENT-------------------------------//
        wrapper.appendChild(customCheckbox);
        wrapper.appendChild(checkbox);
        wrapper.appendChild(taskText);
        wrapper.append(priorityLabel)
        taskElement.appendChild(wrapper);
        targetList.appendChild(taskElement);
      }

      //---------------------------------------------------EDIT BUTTON------------------------------------------------//
      editButton.addEventListener('click', () => {
        if (!selectedTaskData || !selectedTask) {
                  alert("Please select a task to edit.");
                  return;
                }
                //Show the form if task selected.
                bottomSheet.classList.remove('hidden');
                // Fill form with task data all over again
                taskTitle.value = selectedTaskData.title;
                taskDate.value = selectedTaskData.date;
                priority.checked = selectedTaskData.priority;

                // Remove the original task visually and from array for now
                selectedTask.remove();
                allTasks = allTasks.filter(task => !(task.title === selectedTaskData.title && task.date === selectedTaskData.date));
                updateTasksInLocalStorage();
                loadTasksFromStorage();

                // Clear selected state
                selectedTask = null;
                selectedTaskData = null;
              });
      
      ///--------------------------------------------------DELETE BUTTON------------------------------------------//
      deleteButton.addEventListener('click', () => {
        if (!selectedTask || !selectedTaskData) {
          alert("Please select a task to delete.");
          return;
        }
        //Remove from wherever it is 
        selectedTask.remove();

        //Remove from the correct array
        const title = selectedTaskData.title;
        const date = selectedTaskData.date;

        allTasks = allTasks.filter(task => !(task.title === selectedTaskData.title && task.date === selectedTaskData.date));
        updateTasksInLocalStorage();
        loadTasksFromStorage();


        //clear selected task
        selectedTask = null;
        selectedTaskData = null;
      });        
      loadTasksFromStorage();
    });
  </script>
</body>
</html>
